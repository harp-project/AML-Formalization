<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>ProofMode2</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">File ProofMode2</h1>

<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ssreflect</span> <span class="id" title="var">ssrfun</span> <span class="id" title="var">ssrbool</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Ltac2</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Ltac2</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Ensembles</span> <span class="id" title="var">Bool</span> <span class="id" title="var">String</span> <span class="id" title="var">Btauto</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq.Logic</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FunctionalExtensionality</span> <span class="id" title="var">Eqdep_dec</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="keyword">Equations</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="keyword">Equations</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Coq.Program.Tactics</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MatchingLogic</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="keyword">Syntax</span> <span class="id" title="var">DerivedOperators_Syntax</span> <span class="id" title="var">ProofSystem</span> <span class="id" title="var">IndexManipulation</span> <span class="id" title="var">wftactics</span> <span class="id" title="var">Logic</span> <span class="id" title="var">ProofMode</span> <span class="id" title="var">BasicProofSystemLemmas</span> <span class="id" title="var">ProofInfo</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">stdpp</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">list</span> <span class="id" title="var">tactics</span> <span class="id" title="var">fin_sets</span> <span class="id" title="var">coGset</span> <span class="id" title="var">gmap</span> <span class="id" title="var">sets</span>.<br/>

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MatchingLogic.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">stdpp_ext</span>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">extralibrary</span>.<br/>

<br/>
<span class="id" title="keyword">Import</span><br/>
&nbsp;&nbsp;<span class="id" title="var">MatchingLogic.Logic.Notations</span><br/>
&nbsp;&nbsp;<span class="id" title="var">MatchingLogic.DerivedOperators_Syntax.Notations</span><br/>
&nbsp;&nbsp;<span class="id" title="var">MatchingLogic.ProofSystem.Notations</span><br/>
.<br/>

<br/>
<span class="comment">(*&nbsp;Exports&nbsp;*)</span><br/>
<span class="id" title="keyword">Export</span> <span class="id" title="var">MatchingLogic.ProofSystem</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">string_scope</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">list_scope</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ml_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">ProofModeEntry</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} :=<br/>
| <span class="id" title="var">pme_pattern</span> (<span class="id" title="var">p</span> : <span class="id" title="var">Pattern</span>)<br/>
| <span class="id" title="var">pme_variable</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Record</span> <span class="id" title="var">named_hypothesis</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} := <span class="id" title="var">mkNH</span><br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nh_name</span> : <span class="id" title="var">string</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nh_pme</span> : <span class="id" title="var">ProofModeEntry</span>;<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;N ∶ P" :=<br/>
&nbsp;&nbsp;(@<span class="id" title="var">mkNH</span> <span class="id" title="var">_</span> <span class="id" title="var">N</span> <span class="id" title="var">P</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 100, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>, <span class="id" title="var">format</span> "N  '∶'  P", <span class="id" title="var">only</span> <span class="id" title="var">printing</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">hypotheses</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} := <span class="id" title="var">list</span> <span class="id" title="var">named_hypothesis</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;" :=<br/>
&nbsp;&nbsp;(@<span class="id" title="var">nil</span> <span class="id" title="var">named_hypothesis</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 100, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>, <span class="id" title="var">only</span> <span class="id" title="var">printing</span>) : <span class="id" title="var">ml_scope</span>.<br/>
<span class="comment">(*TODO:&nbsp;Ensure&nbsp;that&nbsp;this&nbsp;does&nbsp;not&nbsp;add&nbsp;parentheses*)</span><br/>
<span class="id" title="keyword">Notation</span> &quot;x ," :=<br/>
&nbsp;&nbsp;(@<span class="id" title="var">cons</span> <span class="id" title="var">named_hypothesis</span> <span class="id" title="var">x</span> <span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 100, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>, <span class="id" title="var">format</span> "x ',' '//'", <span class="id" title="var">only</span> <span class="id" title="var">printing</span>) : <span class="id" title="var">ml_scope</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;x , y , .. , z ," :=<br/>
&nbsp;&nbsp;(@<span class="id" title="var">cons</span> <span class="id" title="var">named_hypothesis</span> <span class="id" title="var">x</span> (<span class="id" title="var">cons</span> <span class="id" title="var">y</span> .. (<span class="id" title="var">cons</span> <span class="id" title="var">z</span> <span class="id" title="var">nil</span>) ..))<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 100, <span class="id" title="tactic">left</span> <span class="id" title="keyword">associativity</span>, <span class="id" title="var">format</span> "x ',' '//' y ',' '//' .. ',' '//' z ',' '//'", <span class="id" title="var">only</span> <span class="id" title="var">printing</span>) : <span class="id" title="var">ml_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">names_of</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">h</span> : <span class="id" title="var">hypotheses</span>) : <span class="id" title="var">list</span> <span class="id" title="var">string</span> := <span class="id" title="var">map</span> <span class="id" title="var">nh_name</span> <span class="id" title="var">h</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">pmes_of</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">h</span> : <span class="id" title="var">hypotheses</span>) : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span> := <span class="id" title="var">map</span> <span class="id" title="var">nh_pme</span> <span class="id" title="var">h</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">has_name</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">n</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">nh</span> : <span class="id" title="var">named_hypothesis</span>) : <span class="id" title="keyword">Prop</span><br/>
:= <span class="id" title="var">nh_name</span> <span class="id" title="var">nh</span> = <span class="id" title="var">n</span>.<br/>

<br/>
#[<span class="id" title="var">global</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">has_name_dec</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">n</span> <span class="id" title="var">nh</span> : <span class="id" title="var">Decision</span> (<span class="id" title="var">has_name</span> <span class="id" title="var">n</span> <span class="id" title="var">nh</span>).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">find_hyp</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">name</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">hyps</span> : <span class="id" title="var">hypotheses</span>) : <span class="id" title="var">option</span> (<span class="id" title="var">nat</span> × <span class="id" title="var">named_hypothesis</span>)%<span class="id" title="keyword">type</span><br/>
:= <span class="id" title="var">stdpp.list.list_find</span> (<span class="id" title="var">has_name</span> <span class="id" title="var">name</span>) <span class="id" title="var">hyps</span>.<br/>

<br/>
<span class="id" title="keyword">Record</span> <span class="id" title="var">MLGoal</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} : <span class="id" title="keyword">Type</span> := <span class="id" title="var">mkMLGoal</span><br/>
&nbsp;&nbsp;{ <span class="id" title="var">mlTheory</span> : <span class="id" title="var">Theory</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mlHypotheses</span>: <span class="id" title="var">hypotheses</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mlConclusion</span> : <span class="id" title="var">Pattern</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mlInfo</span> : <span class="id" title="var">ProofSystem.ProofInfo</span> ;<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">MLGoal_from_goal</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">Theory</span>) (<span class="id" title="keyword">goal</span> : <span class="id" title="var">Pattern</span>) (<span class="id" title="var">pi</span> : <span class="id" title="var">ProofInfo</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">MLGoal</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">mkMLGoal</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">nil</span> <span class="id" title="keyword">goal</span> <span class="id" title="var">pi</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">connect</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">h</span> : <span class="id" title="var">ProofModeEntry</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">Pattern</span>) :=<br/>
&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">h</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">pme_pattern</span> <span class="id" title="var">p</span> ⇒ <span class="id" title="var">patt_imp</span> <span class="id" title="var">p</span> <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">pme_variable</span> ⇒ <span class="id" title="var">patt_forall</span> <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">MLGoal_to_pattern'</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">concl</span>: <span class="id" title="var">Pattern</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">Pattern</span><br/>
:= <span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> <span class="id" title="var">concl</span> <span class="id" title="var">pmes</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">MLGoal_to_pattern</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">MG</span> : <span class="id" title="var">MLGoal</span>) : <span class="id" title="var">Pattern</span><br/>
:= <span class="id" title="var">MLGoal_to_pattern'</span> (<span class="id" title="var">mlConclusion</span> <span class="id" title="var">MG</span>) (<span class="id" title="var">pmes_of</span> (<span class="id" title="var">mlHypotheses</span> <span class="id" title="var">MG</span>)).<br/>

<br/>
<span class="id" title="keyword">Coercion</span> <span class="id" title="var">of_MLGoal</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">MG</span> : <span class="id" title="var">MLGoal</span>) : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> (<span class="id" title="var">MLGoal_to_pattern</span> <span class="id" title="var">MG</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">mlTheory</span> <span class="id" title="var">MG</span>) ⊢<span class="id" title="var">i</span> (<span class="id" title="var">MLGoal_to_pattern</span> <span class="id" title="var">MG</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">using</span> (<span class="id" title="var">mlInfo</span> <span class="id" title="var">MG</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;This&nbsp;is&nbsp;useful&nbsp;only&nbsp;for&nbsp;printing.&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x2c75&nbsp;was&nbsp;used&nbsp;for&nbsp;the&nbsp;⊢&nbsp;to&nbsp;avoid&nbsp;collision&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;G 'Ⱶ' g 'using' pi "<br/>
&nbsp;&nbsp;:= (<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">_</span> <span class="id" title="var">G</span> [] <span class="id" title="var">g</span> <span class="id" title="var">pi</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 95,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">format</span> "G  'Ⱶ' '//' g '//' 'using'  pi '//'",<br/>
&nbsp;&nbsp;<span class="id" title="var">only</span> <span class="id" title="var">printing</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;G 'Ⱶ' g"<br/>
&nbsp;&nbsp;:= (<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">_</span> <span class="id" title="var">G</span> [] <span class="id" title="var">g</span> <span class="id" title="var">AnyReasoning</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 95,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">format</span> "G  'Ⱶ' '//'  g '//'",<br/>
&nbsp;&nbsp;<span class="id" title="var">only</span> <span class="id" title="var">printing</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;G 'Ⱶ' l -------------------------------------- g 'using' pi "<br/>
&nbsp;&nbsp;:= (<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">_</span> <span class="id" title="var">G</span> <span class="id" title="var">l</span> <span class="id" title="var">g</span> <span class="id" title="var">pi</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 95,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">format</span> "G  'Ⱶ' '//' l -------------------------------------- '//' g '//' 'using'  pi '//'",<br/>
&nbsp;&nbsp;<span class="id" title="var">only</span> <span class="id" title="var">printing</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;G 'Ⱶ' l -------------------------------------- g"<br/>
&nbsp;&nbsp;:= (<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">_</span> <span class="id" title="var">G</span> <span class="id" title="var">l</span> <span class="id" title="var">g</span> <span class="id" title="var">AnyReasoning</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 95,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">format</span> "G  'Ⱶ' '//' l -------------------------------------- '//' g '//'",<br/>
&nbsp;&nbsp;<span class="id" title="var">only</span> <span class="id" title="var">printing</span>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">toMLGoal</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">ProofSystem.derives</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ |- ?<span class="id" title="var">G</span> ⊢<span class="id" title="var">i</span> ?<span class="id" title="var">phi</span> <span class="id" title="keyword">using</span> ?<span class="id" title="var">pi</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;⇒ <span class="id" title="tactic">cut</span> (<span class="id" title="var">of_MLGoal</span> (<span class="id" title="var">MLGoal_from_goal</span> <span class="id" title="var">G</span> <span class="id" title="var">phi</span> <span class="id" title="var">pi</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">MLGoal_from_goal</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(<span class="id" title="tactic">unfold</span> <span class="id" title="var">of_MLGoal</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="keyword">let</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">fresh</span> "H" <span class="id" title="tactic">in</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>; <span class="id" title="var">cbn</span>)|]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">fromMLGoal</span> := <span class="id" title="tactic">unfold</span> <span class="id" title="var">of_MLGoal</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">_</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cast_proof_ml_hyps</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> <span class="id" title="var">hyps</span> <span class="id" title="var">hyps'</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">e</span> : <span class="id" title="var">hyps</span> = <span class="id" title="var">hyps'</span>) <span class="id" title="keyword">goal</span> (<span class="id" title="var">i</span> : <span class="id" title="var">ProofInfo</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">hyps</span> <span class="id" title="keyword">goal</span> <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">hyps'</span> <span class="id" title="keyword">goal</span> <span class="id" title="var">i</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cast_proof_ml_goal</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> <span class="id" title="var">hyps</span> <span class="id" title="keyword">goal</span> <span class="id" title="var">goal'</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">e</span> : <span class="id" title="keyword">goal</span> = <span class="id" title="var">goal'</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">ProofInfo</span>):<br/>
&nbsp;&nbsp;<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">hyps</span> <span class="id" title="keyword">goal</span> <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">hyps</span> <span class="id" title="var">goal'</span> <span class="id" title="var">i</span> .<br/>

<br/>
<span class="comment">(*&nbsp;Extracts&nbsp;well-formedness&nbsp;assumptions&nbsp;about&nbsp;(local)&nbsp;goal&nbsp;and&nbsp;(local)&nbsp;hypotheses.&nbsp;*)</span><br/>
<span class="id" title="keyword">Tactic Notation</span> "mlExtractWF" <span class="id" title="var">ident</span>(<span class="id" title="var">wfa</span>) :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
| [ |- ?<span class="id" title="var">g</span> ] ⇒<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">wfa'</span> := <span class="id" title="tactic">fresh</span> "wfa'" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">wfa'</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">pose</span> <span class="id" title="var">proof</span> (<span class="id" title="var">wfa</span> := <span class="id" title="var">wfa'</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">revert</span> <span class="id" title="var">wfa'</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">fold</span> <span class="id" title="var">g</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">wfa</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MLGoal_introImpl</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">Theory</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">hypotheses</span>) (<span class="id" title="var">name</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">x</span> <span class="id" title="var">g</span> : <span class="id" title="var">Pattern</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">i</span> : <span class="id" title="var">ProofInfo</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">_</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">l</span> ++ [<span class="id" title="var">mkNH</span> <span class="id" title="var">_</span> <span class="id" title="var">name</span> (<span class="id" title="var">pme_pattern</span> <span class="id" title="var">x</span>)]) <span class="id" title="var">g</span> <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">_</span> <span class="id" title="var">Γ</span> <span class="id" title="var">l</span> (<span class="id" title="var">x</span> ---&gt; <span class="id" title="var">g</span>) <span class="id" title="var">i</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">simplLocalContext</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ |- @<span class="id" title="var">of_MLGoal</span> ?<span class="id" title="var">Sgm</span> (<span class="id" title="var">mkMLGoal</span> ?<span class="id" title="var">Sgm</span> ?<span class="id" title="var">Ctx</span> ?<span class="id" title="var">l</span> ?<span class="id" title="var">g</span> ?<span class="id" title="var">i</span>) ]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ <span class="id" title="tactic">eapply</span> <span class="id" title="var">cast_proof_ml_hyps</span>;[(<span class="id" title="tactic">rewrite</span> {1}[<span class="id" title="var">l</span>]/<span class="id" title="var">app</span>; <span class="id" title="tactic">reflexivity</span>)|]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">_getHypNames</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ |- <span class="id" title="var">of_MLGoal</span> (<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ?<span class="id" title="var">l</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) ] ⇒ <span class="id" title="tactic">eval</span> <span class="id" title="tactic">lazy</span> <span class="id" title="tactic">in</span> (<span class="id" title="var">names_of</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "_failIfUsed" <span class="id" title="keyword">constr</span>(<span class="id" title="var">name</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ |- <span class="id" title="var">of_MLGoal</span> (<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> ?<span class="id" title="var">l</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) ] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> (<span class="id" title="tactic">eval</span> <span class="id" title="tactic">cbv</span> <span class="id" title="tactic">in</span> (<span class="id" title="var">find_hyp</span> <span class="id" title="var">name</span> <span class="id" title="var">l</span>)) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="tactic">fail</span> "The name" <span class="id" title="var">name</span> "is already used"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="tactic">idtac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "mlIntro" <span class="id" title="keyword">constr</span>(<span class="id" title="var">name'</span>) :=<br/>
<span class="id" title="var">_failIfUsed</span> <span class="id" title="var">name'</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">MLGoal_introImpl</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">name</span> := <span class="id" title="var">name'</span>); <span class="id" title="var">simplLocalContext</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "mlIntro" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">hyps</span> := <span class="id" title="var">_getHypNames</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">name'</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">cbv</span> <span class="id" title="tactic">in</span> (<span class="id" title="tactic">fresh</span> <span class="id" title="var">hyps</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">mlIntro</span> <span class="id" title="var">name'</span>.<br/>

<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MLGoal_revertLast</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">Theory</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">hypotheses</span>) (<span class="id" title="var">x</span> <span class="id" title="var">g</span> : <span class="id" title="var">Pattern</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">string</span>) <span class="id" title="var">i</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">l</span> (<span class="id" title="var">x</span> ---&gt; <span class="id" title="var">g</span>) <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">l</span> ++ [<span class="id" title="var">mkNH</span> <span class="id" title="var">_</span> <span class="id" title="var">n</span> (<span class="id" title="var">pme_pattern</span> <span class="id" title="var">x</span>)]) <span class="id" title="var">g</span> <span class="id" title="var">i</span>.<br/>

<br/>
#[<span class="id" title="var">global</span>]<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">mlRevertLast</span> :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
| |- @<span class="id" title="var">of_MLGoal</span> ?<span class="id" title="var">Sgm</span> (<span class="id" title="var">mkMLGoal</span> ?<span class="id" title="var">Sgm</span> ?<span class="id" title="var">Ctx</span> ?<span class="id" title="var">l</span> ?<span class="id" title="var">g</span> ?<span class="id" title="var">i</span>)<br/>
⇒ <span class="id" title="tactic">eapply</span> <span class="id" title="var">cast_proof_ml_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;[(<span class="id" title="tactic">rewrite</span> -[<span class="id" title="var">l</span>](<span class="id" title="var">take_drop</span> (<span class="id" title="var">length</span> <span class="id" title="var">l</span> - 1)); <span class="id" title="tactic">rewrite</span> [<span class="id" title="var">take</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>]/=; <span class="id" title="tactic">rewrite</span> [<span class="id" title="var">drop</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>]/=; <span class="id" title="tactic">reflexivity</span>)|];<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">MLGoal_revertLast</span><br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MLGoal_introForall</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">Theory</span>) (<span class="id" title="var">l</span> : <span class="id" title="var">hypotheses</span>) (<span class="id" title="var">name</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">g</span> : <span class="id" title="var">Pattern</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">i</span> : <span class="id" title="var">ProofInfo</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">_</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">l</span> ++ [<span class="id" title="var">mkNH</span> <span class="id" title="var">_</span> <span class="id" title="var">name</span> (<span class="id" title="var">pme_variable</span>)]) <span class="id" title="var">g</span> <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">_</span> <span class="id" title="var">Γ</span> <span class="id" title="var">l</span> (<span class="id" title="var">all</span>, <span class="id" title="var">g</span>) <span class="id" title="var">i</span>.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "mlIntroForall" <span class="id" title="keyword">constr</span>(<span class="id" title="var">name'</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">_failIfUsed</span> <span class="id" title="var">name'</span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">MLGoal_introForall</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">name</span> := <span class="id" title="var">name'</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">simplLocalContext</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "mlIntroForall" :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">hyps</span> := <span class="id" title="var">_getHypNames</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">name'</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">cbv</span> <span class="id" title="tactic">in</span> (<span class="id" title="tactic">fresh</span> <span class="id" title="var">hyps</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">mlIntroForall</span> <span class="id" title="var">name'</span><br/>
.<br/>

<br/>
#[<span class="id" title="var">local</span>]<br/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">ex_introForall</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">Theory</span>) (<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> : <span class="id" title="var">Pattern</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> <span class="id" title="var">a</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> <span class="id" title="var">b</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢ <span class="id" title="var">all</span>, (<span class="id" title="var">a</span> ---&gt; (<span class="id" title="var">all</span>, (<span class="id" title="var">b</span> ---&gt; <span class="id" title="var">c</span>)))<br/>
.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">is_variable</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">pme</span>: <span class="id" title="var">ProofModeEntry</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">pme</span> = <span class="id" title="var">pme_variable</span><br/>
.<br/>

<br/>
#[<span class="id" title="var">global</span>]<br/>
<span class="id" title="keyword">Instance</span> <span class="id" title="var">is_variable_dec</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">pme</span>: <span class="id" title="var">ProofModeEntry</span>)<br/>
: <span class="id" title="var">Decision</span> (<span class="id" title="var">is_variable</span> <span class="id" title="var">pme</span>).<br/>
 
<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">foralls_count</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>) : <span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">length</span> (<span class="id" title="var">filter</span> <span class="id" title="var">is_variable</span> <span class="id" title="var">pmes</span>).<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">evar_fresh_nth</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">avoid</span> : <span class="id" title="var">EVarSet</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="tactic">evar</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="var">evar_fresh_s</span> <span class="id" title="var">avoid</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">S</span> <span class="id" title="var">n'</span>) ⇒ <span class="id" title="var">evar_fresh_nth</span> (<span class="id" title="var">avoid</span> ∪ {[(<span class="id" title="var">evar_fresh_s</span> <span class="id" title="var">avoid</span>)]}) <span class="id" title="var">n'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">evar_open_fresh_iter_base</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">avoid</span> : <span class="id" title="var">EVarSet</span>) (<span class="id" title="var">base</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">Pattern</span>) : <span class="id" title="var">Pattern</span><br/>
:= <span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| 0 ⇒ <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">S</span> <span class="id" title="var">n'</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">x</span> := (<span class="id" title="var">evar_fresh_s</span> <span class="id" title="var">avoid</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">p'</span> := (<span class="id" title="var">evar_open</span> <span class="id" title="var">x</span> (<span class="id" title="var">base</span> + <span class="id" title="var">n'</span>) <span class="id" title="var">p</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">evar_open_fresh_iter_base</span> (<span class="id" title="var">avoid</span> ∪ {[<span class="id" title="var">x</span>]}) <span class="id" title="var">base</span> <span class="id" title="var">n'</span> <span class="id" title="var">p'</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">evar_open_fresh_iter</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">avoid</span> : <span class="id" title="var">EVarSet</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">Pattern</span>) : <span class="id" title="var">Pattern</span><br/>
&nbsp;&nbsp;:= <span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> 0 <span class="id" title="var">n</span> <span class="id" title="var">p</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">evar_open_pmes</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">idx</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">x</span> : <span class="id" title="tactic">evar</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">pmes</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] ⇒ <span class="id" title="var">pmes</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">pme_pattern</span> <span class="id" title="var">p</span>)::<span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;⇒ (<span class="id" title="var">pme_pattern</span> (<span class="id" title="var">evar_open</span> <span class="id" title="var">x</span> <span class="id" title="var">idx</span> <span class="id" title="var">p</span>))::(<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">x</span> <span class="id" title="var">pmes'</span>)<br/>
&nbsp;&nbsp;| (<span class="id" title="var">pme_variable</span>)::<span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;⇒ (<span class="id" title="var">pme_variable</span>)::(<span class="id" title="var">evar_open_pmes</span> (<span class="id" title="var">S</span> <span class="id" title="var">idx</span>) <span class="id" title="var">x</span> <span class="id" title="var">pmes'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">foralls_count_evar_open_pmes</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">idx</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">x</span> : <span class="id" title="tactic">evar</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">foralls_count</span> (<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">x</span> <span class="id" title="var">pmes</span>) = <span class="id" title="var">foralls_count</span> <span class="id" title="var">pmes</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">length_evar_open_pmes</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">idx</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">x</span> : <span class="id" title="tactic">evar</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">length</span> (<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">x</span> <span class="id" title="var">pmes</span>) = <span class="id" title="var">length</span> <span class="id" title="var">pmes</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evar_open_foldr_connect</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">g</span> : <span class="id" title="var">Pattern</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">x</span> : <span class="id" title="tactic">evar</span>) (<span class="id" title="var">idx</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;(<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">g</span> <span class="id" title="var">pmes</span>)^{<span class="id" title="tactic">evar</span>:<span class="id" title="var">idx</span>↦<span class="id" title="var">x</span>}<br/>
&nbsp;&nbsp;= <span class="id" title="var">foldr</span> <span class="id" title="var">connect</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">g</span>^{<span class="id" title="tactic">evar</span>:(<span class="id" title="var">idx</span> + <span class="id" title="var">foralls_count</span> <span class="id" title="var">pmes</span>)↦<span class="id" title="var">x</span>})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">x</span> <span class="id" title="var">pmes</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evar_open_pmes_comm_higher</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">pmes</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> (<span class="id" title="var">evar_open_pmes</span> (<span class="id" title="var">S</span> <span class="id" title="var">m</span>) <span class="id" title="var">x</span> <span class="id" title="var">pmes</span>)<br/>
&nbsp;&nbsp;= <span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> (<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">pmes</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wf_all_MLGoal_to_pattern'</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">g</span> : <span class="id" title="var">Pattern</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>) (<span class="id" title="var">x</span> : <span class="id" title="tactic">evar</span>) (<span class="id" title="var">m</span> <span class="id" title="var">n</span> : <span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_xy</span> <span class="id" title="var">m</span> <span class="id" title="var">n</span> (<span class="id" title="var">all</span> , <span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">g</span> <span class="id" title="var">pmes</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_xy</span> <span class="id" title="var">m</span> <span class="id" title="var">n</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">g</span>^[<span class="id" title="tactic">evar</span>:<span class="id" title="var">m</span> + (<span class="id" title="var">foralls_count</span> <span class="id" title="var">pmes</span>)↦<span class="id" title="var">patt_free_evar</span> <span class="id" title="var">x</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">pmes</span>)<br/>
&nbsp;&nbsp;)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bevar_occur_Sn_bevar_occur_bsvar_subst_n</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">p</span> <span class="id" title="var">q</span> : <span class="id" title="var">Pattern</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">bevar_occur</span> <span class="id" title="var">p</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">bevar_occur</span> (<span class="id" title="var">bevar_subst</span> <span class="id" title="var">q</span> <span class="id" title="var">n</span> <span class="id" title="var">p</span>) <span class="id" title="var">n</span> = <span class="id" title="var">true</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bevar_occur_foldr_connect</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">g</span> : <span class="id" title="var">Pattern</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_ex_aux</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">g</span> <span class="id" title="var">pmes</span>) <span class="id" title="var">k</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">bevar_occur</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">g</span> <span class="id" title="var">pmes</span>) <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;= <span class="id" title="var">bevar_occur</span> <span class="id" title="var">g</span> (<span class="id" title="var">k</span> + (<span class="id" title="var">foralls_count</span> <span class="id" title="var">pmes</span>))<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bevar_occur_foldr_connect'</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">g</span> : <span class="id" title="var">Pattern</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">bevar_occur</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">patt_bott</span> <span class="id" title="var">pmes</span>) <span class="id" title="var">k</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">bevar_occur</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">g</span> <span class="id" title="var">pmes</span>) <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;= <span class="id" title="var">bevar_occur</span> <span class="id" title="var">g</span> (<span class="id" title="var">k</span> + (<span class="id" title="var">foralls_count</span> <span class="id" title="var">pmes</span>))<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bevar_occur_foldr_connect''</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">g</span> : <span class="id" title="var">Pattern</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>) (<span class="id" title="var">k</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">bevar_occur</span> <span class="id" title="var">g</span> (<span class="id" title="var">k</span> + (<span class="id" title="var">foralls_count</span> <span class="id" title="var">pmes</span>)) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">bevar_occur</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">g</span> <span class="id" title="var">pmes</span>) <span class="id" title="var">k</span> = <span class="id" title="var">true</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfc_ex_aux_foldr_connect</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">g</span> <span class="id" title="var">pmes</span> <span class="id" title="var">k</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_ex_aux</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">g</span> <span class="id" title="var">pmes</span>) <span class="id" title="var">k</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_ex_aux</span> <span class="id" title="var">g</span> (<span class="id" title="var">k</span> + (<span class="id" title="var">foralls_count</span> <span class="id" title="var">pmes</span>)) = <span class="id" title="var">true</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">wfcex_pmes</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">idx</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">bool</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">pmes</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] ⇒ <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">pme_pattern</span> <span class="id" title="var">p</span>)::<span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;⇒ <span class="id" title="var">well_formed_closed_ex_aux</span> <span class="id" title="var">p</span> <span class="id" title="var">idx</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">wfcex_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">pme_variable</span>)::<span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;⇒ <span class="id" title="var">wfcex_pmes</span> (<span class="id" title="var">S</span> <span class="id" title="var">idx</span>) <span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfc_ex_aux_foldr_connect'</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">g</span> <span class="id" title="var">pmes</span> <span class="id" title="var">k</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_ex_aux</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">g</span> <span class="id" title="var">pmes</span>) <span class="id" title="var">k</span> <br/>
&nbsp;&nbsp;= <span class="id" title="var">well_formed_closed_ex_aux</span> <span class="id" title="var">g</span> (<span class="id" title="var">k</span> + (<span class="id" title="var">foralls_count</span> <span class="id" title="var">pmes</span>))<br/>
&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">wfcex_pmes</span> <span class="id" title="var">k</span> <span class="id" title="var">pmes</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lift_to_mixed_context'</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">Theory</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">concl₁</span> <span class="id" title="var">concl₂</span>: <span class="id" title="var">Pattern</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">i</span> : <span class="id" title="var">ProofInfo</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO&nbsp;relax&nbsp;ExGen&nbsp;*)</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">pile</span> : <span class="id" title="var">ProofInfoLe</span> (<span class="id" title="var">ExGen</span> := ⊤, <span class="id" title="var">SVSubst</span> := ∅, <span class="id" title="var">KT</span> := <span class="id" title="var">false</span>) <span class="id" title="var">i</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">concl₁</span> <span class="id" title="var">pmes</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">concl₂</span> <span class="id" title="var">pmes</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<span class="id" title="var">avoid</span> : <span class="id" title="var">EVarSet</span>),<br/>
&nbsp;&nbsp;<span class="id" title="var">free_evars</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">concl₁</span> <span class="id" title="var">pmes</span>) ⊆ <span class="id" title="var">avoid</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">free_evars</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">concl₂</span> <span class="id" title="var">pmes</span>) ⊆ <span class="id" title="var">avoid</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢<span class="id" title="var">i</span> (<span class="id" title="var">evar_open_fresh_iter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">avoid</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">foralls_count</span> <span class="id" title="var">pmes</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">concl₂</span> ---&gt; <span class="id" title="var">concl₁</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id" title="keyword">using</span> <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢<span class="id" title="var">i</span> ((<span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> <span class="id" title="var">concl₂</span> <span class="id" title="var">pmes</span>) ---&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> <span class="id" title="var">concl₁</span> <span class="id" title="var">pmes</span>)) <span class="id" title="keyword">using</span> <span class="id" title="var">i</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">lift_to_mixed_context</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">Theory</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">concl₁</span> <span class="id" title="var">concl₂</span>: <span class="id" title="var">Pattern</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">i</span> : <span class="id" title="var">ProofInfo</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO&nbsp;relax&nbsp;ExGen&nbsp;*)</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">pile</span> : <span class="id" title="var">ProofInfoLe</span> (<span class="id" title="var">ExGen</span> := ⊤, <span class="id" title="var">SVSubst</span> := ∅, <span class="id" title="var">KT</span> := <span class="id" title="var">false</span>) <span class="id" title="var">i</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">concl₁</span> <span class="id" title="var">pmes</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">concl₂</span> <span class="id" title="var">pmes</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢<span class="id" title="var">i</span> (<span class="id" title="var">evar_open_fresh_iter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">free_evars</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">concl₁</span> <span class="id" title="var">pmes</span>) ∪ <span class="id" title="var">free_evars</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">concl₂</span> <span class="id" title="var">pmes</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">foralls_count</span> <span class="id" title="var">pmes</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">concl₂</span> ---&gt; <span class="id" title="var">concl₁</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id" title="keyword">using</span> <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢<span class="id" title="var">i</span> ((<span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> <span class="id" title="var">concl₂</span> <span class="id" title="var">pmes</span>) ---&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> <span class="id" title="var">concl₁</span> <span class="id" title="var">pmes</span>)) <span class="id" title="keyword">using</span> <span class="id" title="var">i</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wf_lift_helper'</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">hyps</span> <span class="id" title="var">concl₁</span> <span class="id" title="var">concl₂</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_xy</span> (<span class="id" title="var">x</span> + <span class="id" title="var">foralls_count</span> (<span class="id" title="var">pmes_of</span> <span class="id" title="var">hyps</span>)) <span class="id" title="var">y</span> <span class="id" title="var">concl₂</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_xy</span> (<span class="id" title="var">x</span>) <span class="id" title="var">y</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">concl₁</span> (<span class="id" title="var">map</span> <span class="id" title="var">nh_pme</span> <span class="id" title="var">hyps</span>)) →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_xy</span> (<span class="id" title="var">x</span>) <span class="id" title="var">y</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">concl₂</span> (<span class="id" title="var">map</span> <span class="id" title="var">nh_pme</span> <span class="id" title="var">hyps</span>))<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wf_lift_helper</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">hyps</span> <span class="id" title="var">concl₁</span> <span class="id" title="var">concl₂</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_xy</span> (<span class="id" title="var">foralls_count</span> (<span class="id" title="var">pmes_of</span> <span class="id" title="var">hyps</span>)) 0 <span class="id" title="var">concl₂</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">concl₁</span> (<span class="id" title="var">map</span> <span class="id" title="var">nh_pme</span> <span class="id" title="var">hyps</span>)) →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">concl₂</span> (<span class="id" title="var">map</span> <span class="id" title="var">nh_pme</span> <span class="id" title="var">hyps</span>))<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">MLGoal_lift_to_mixed_context</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">Γ</span> : <span class="id" title="var">Theory</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">concl₁</span> <span class="id" title="var">concl₂</span>: <span class="id" title="var">Pattern</span>) (<span class="id" title="var">hyps</span> : <span class="id" title="var">hypotheses</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">i</span> : <span class="id" title="var">ProofInfo</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO&nbsp;relax&nbsp;ExGen&nbsp;*)</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">pile</span> : <span class="id" title="var">ProofInfoLe</span> (<span class="id" title="var">ExGen</span> := ⊤, <span class="id" title="var">SVSubst</span> := ∅, <span class="id" title="var">KT</span> := <span class="id" title="var">false</span>) <span class="id" title="var">i</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_xy</span> (<span class="id" title="var">foralls_count</span> (<span class="id" title="var">pmes_of</span> <span class="id" title="var">hyps</span>)) 0 <span class="id" title="var">concl₂</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢<span class="id" title="var">i</span> (<span class="id" title="var">evar_open_fresh_iter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">free_evars</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">concl₁</span> (<span class="id" title="var">pmes_of</span> <span class="id" title="var">hyps</span>)) ∪ <span class="id" title="var">free_evars</span> (<span class="id" title="var">MLGoal_to_pattern'</span> <span class="id" title="var">concl₂</span> (<span class="id" title="var">pmes_of</span> <span class="id" title="var">hyps</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">foralls_count</span> (<span class="id" title="var">pmes_of</span> <span class="id" title="var">hyps</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">concl₂</span> ---&gt; <span class="id" title="var">concl₁</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id" title="keyword">using</span> <span class="id" title="var">i</span> →<br/>
&nbsp;&nbsp;(<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">hyps</span> <span class="id" title="var">concl₂</span> <span class="id" title="var">i</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">Σ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">hyps</span> <span class="id" title="var">concl₁</span> <span class="id" title="var">i</span>)<br/>
.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">_mlCut</span> <span class="id" title="var">g'</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [ |- @<span class="id" title="var">of_MLGoal</span> ?<span class="id" title="var">S</span> (<span class="id" title="var">mkMLGoal</span> ?<span class="id" title="var">S</span> ?<span class="id" title="var">T</span> ?<span class="id" title="var">l</span> ?<span class="id" title="var">g</span> ?<span class="id" title="var">i</span>)] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">cut</span> (@<span class="id" title="var">of_MLGoal</span> <span class="id" title="var">S</span> (<span class="id" title="var">mkMLGoal</span> <span class="id" title="var">S</span> <span class="id" title="var">T</span> <span class="id" title="var">l</span> <span class="id" title="var">g'</span> <span class="id" title="var">i</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;[(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">fresh</span> "H" <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">MLGoal_lift_to_mixed_context</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">concl₂</span> := <span class="id" title="var">g'</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">try_solve_pile</span>)|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">cbn</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">decide</span>; <span class="id" title="var">cbn</span>)|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">cbn</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">decide</span>; <span class="id" title="var">cbn</span>)|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">exact</span> <span class="id" title="var">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;)|]<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>
<span class="id" title="keyword">Tactic Notation</span> "mlCut" <span class="id" title="keyword">constr</span>(<span class="id" title="var">g'</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">_mlCut</span> <span class="id" title="var">g'</span><br/>
.<br/>

<br/>
#[<span class="id" title="var">local</span>]<br/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">ex_mlCut</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">Γ</span> : <span class="id" title="var">Theory</span>) (<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> : <span class="id" title="var">Pattern</span>) (<span class="id" title="var">s1</span> <span class="id" title="var">s2</span> : <span class="id" title="var">symbols</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> <span class="id" title="var">a</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> <span class="id" title="var">b</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢ (<span class="id" title="var">patt_sym</span> <span class="id" title="var">s1</span> ---&gt; <span class="id" title="var">patt_sym</span> <span class="id" title="var">s2</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢ <span class="id" title="var">all</span>, (<span class="id" title="var">a</span> $ <span class="id" title="var">b0</span> ---&gt; <span class="id" title="var">all</span>, (<span class="id" title="var">b0</span> $ <span class="id" title="var">b</span> $ <span class="id" title="var">b1</span> ---&gt; <span class="id" title="var">all</span>, (<span class="id" title="var">patt_sym</span> <span class="id" title="var">s1</span>))) →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢ <span class="id" title="var">all</span>, (<span class="id" title="var">a</span> $ <span class="id" title="var">b0</span> ---&gt; <span class="id" title="var">all</span>, (<span class="id" title="var">b0</span> $ <span class="id" title="var">b</span> $ <span class="id" title="var">b1</span> ---&gt; <span class="id" title="var">all</span>, (<span class="id" title="var">patt_sym</span> <span class="id" title="var">s2</span>)))<br/>
.<br/>

<br/>
#[<span class="id" title="var">local</span>]<br/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">ex_mlCut2</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">Γ</span> : <span class="id" title="var">Theory</span>) (<span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> : <span class="id" title="var">Pattern</span>) (<span class="id" title="var">s1</span> <span class="id" title="var">s2</span> : <span class="id" title="var">symbols</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> <span class="id" title="var">a</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> <span class="id" title="var">b</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> <span class="id" title="var">c</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢ (<span class="id" title="var">patt_sym</span> <span class="id" title="var">s1</span> ---&gt; <span class="id" title="var">patt_sym</span> <span class="id" title="var">s2</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢ <span class="id" title="var">all</span>, (<span class="id" title="var">a</span> $ <span class="id" title="var">b0</span> ---&gt; <span class="id" title="var">all</span>, (<span class="id" title="var">b0</span> $ <span class="id" title="var">b</span> $ <span class="id" title="var">b1</span> ---&gt; <span class="id" title="var">all</span>, (<span class="id" title="var">patt_sym</span> <span class="id" title="var">s1</span> $ <span class="id" title="var">b1</span>))) →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢ <span class="id" title="var">all</span>, (<span class="id" title="var">a</span> $ <span class="id" title="var">b0</span> ---&gt; <span class="id" title="var">all</span>, (<span class="id" title="var">b0</span> $ <span class="id" title="var">b</span> $ <span class="id" title="var">b1</span> ---&gt; <span class="id" title="var">all</span>, (<span class="id" title="var">patt_sym</span> <span class="id" title="var">s2</span> $ <span class="id" title="var">b1</span>)))<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evar_open_fresh_iter_impl</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">avoid</span> <span class="id" title="var">m</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">base</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> <span class="id" title="var">base</span> <span class="id" title="var">m</span>  (<span class="id" title="var">a</span> ---&gt; <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;= (<span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> <span class="id" title="var">base</span> <span class="id" title="var">m</span> <span class="id" title="var">a</span> ---&gt; <span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> <span class="id" title="var">base</span> <span class="id" title="var">m</span> <span class="id" title="var">b</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evar_open_fresh_iter_top</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">avoid</span> <span class="id" title="var">m</span>  <span class="id" title="var">base</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> <span class="id" title="var">base</span> <span class="id" title="var">m</span> <span class="id" title="var">patt_top</span><br/>
&nbsp;&nbsp;= <span class="id" title="var">patt_top</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evar_open_fresh_iter_base_wfc_aux</span>:<br/>
&nbsp;&nbsp;∀ {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">db2</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">phi</span> : <span class="id" title="var">Pattern</span>) <span class="id" title="var">avoid</span> <span class="id" title="var">base</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_ex_aux</span> <span class="id" title="var">phi</span> 0 →<br/>
&nbsp;&nbsp;<span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> <span class="id" title="var">base</span> <span class="id" title="var">db2</span> <span class="id" title="var">phi</span> = <span class="id" title="var">phi</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evar_open_fresh_iter_wfc_aux</span>:<br/>
&nbsp;&nbsp;∀ {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">db2</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">phi</span> : <span class="id" title="var">Pattern</span>) <span class="id" title="var">avoid</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_ex_aux</span> <span class="id" title="var">phi</span> 0 →<br/>
&nbsp;&nbsp;<span class="id" title="var">evar_open_fresh_iter</span> <span class="id" title="var">avoid</span> <span class="id" title="var">db2</span> <span class="id" title="var">phi</span> = <span class="id" title="var">phi</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">well_formed_evar_open_fresh_iter</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">avoid</span> <span class="id" title="var">m</span> <span class="id" title="var">p</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_xy</span> <span class="id" title="var">m</span> 0 <span class="id" title="var">p</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> (<span class="id" title="var">evar_open_fresh_iter</span> <span class="id" title="var">avoid</span> <span class="id" title="var">m</span> <span class="id" title="var">p</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evar_open_fresh_iter_base_forall</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">avoid</span> <span class="id" title="var">base</span> <span class="id" title="var">m</span> <span class="id" title="var">p</span> <span class="id" title="var">l</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> <span class="id" title="var">base</span> <span class="id" title="var">m</span> (<span class="id" title="var">all</span> , <span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">p</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;= <span class="id" title="var">all</span>, (<span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> (<span class="id" title="var">S</span> <span class="id" title="var">base</span>) <span class="id" title="var">m</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">p</span> <span class="id" title="var">l</span>))<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">forall_quantify_evar_open</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">x'</span> <span class="id" title="var">p</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">x'</span> ∉ <span class="id" title="var">free_evars</span> <span class="id" title="var">p</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_ex_aux</span> <span class="id" title="var">p</span> 1 →<br/>
&nbsp;&nbsp;(<span class="id" title="var">forall_quantify</span> <span class="id" title="var">x'</span> (<span class="id" title="var">evar_open</span> <span class="id" title="var">x'</span> 0 <span class="id" title="var">p</span>))<br/>
&nbsp;&nbsp;= (<span class="id" title="var">all</span> , <span class="id" title="var">p</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evar_fresh_nth_avoid</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">avoid</span> <span class="id" title="var">m</span> :<br/>
&nbsp;<span class="id" title="var">evar_fresh_nth</span> (<span class="id" title="var">avoid</span>) <span class="id" title="var">m</span> ∉ <span class="id" title="var">avoid</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evar_fresh_nth_notin_free_evars_evar_open_fresh_iter_base</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">avoid</span> : <span class="id" title="var">EVarSet</span>) (<span class="id" title="var">base</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">Pattern</span>)<br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;(<span class="id" title="keyword">∀</span> <span class="id" title="var">m</span>, (<span class="id" title="var">evar_fresh_nth</span> <span class="id" title="var">avoid</span> <span class="id" title="var">m</span>) ∉ (<span class="id" title="var">free_evars</span> <span class="id" title="var">p</span>)) →<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <span class="id" title="var">m</span>, (<span class="id" title="var">evar_fresh_nth</span> <span class="id" title="var">avoid</span> <span class="id" title="var">m</span>)<br/>
&nbsp;&nbsp;∉ <span class="id" title="var">free_evars</span> (<span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> <span class="id" title="var">base</span> <span class="id" title="var">m</span> <span class="id" title="var">p</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfce_eofib</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">avoid</span> <span class="id" title="var">base</span> <span class="id" title="var">m</span> <span class="id" title="var">phi</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_ex_aux</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> <span class="id" title="var">base</span> <span class="id" title="var">m</span> <span class="id" title="var">phi</span>) <span class="id" title="var">base</span><br/>
&nbsp;&nbsp;= <span class="id" title="var">well_formed_closed_ex_aux</span> <span class="id" title="var">phi</span> (<span class="id" title="var">base</span>+<span class="id" title="var">m</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfcex_pmes_evar_open_pmes</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;<span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">wfcex_pmes</span> <span class="id" title="var">m</span> (<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">wfcex_pmes</span> (<span class="id" title="var">S</span> <span class="id" title="var">m</span>) <span class="id" title="var">l</span> = <span class="id" title="var">true</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfc_ex_aux_body_iff'</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} (<span class="id" title="var">phi</span> : <span class="id" title="var">Pattern</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">x</span> : <span class="id" title="tactic">evar</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_ex_aux</span> <span class="id" title="var">phi</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) <br/>
&nbsp;&nbsp;= <span class="id" title="var">well_formed_closed_ex_aux</span> <span class="id" title="var">phi</span>^{<span class="id" title="tactic">evar</span>:<span class="id" title="var">n</span>↦<span class="id" title="var">x</span>} <span class="id" title="var">n</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfcex_pmes_evar_open_pmes_iff</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;<span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;:<br/>
&nbsp;&nbsp;<span class="id" title="var">wfcex_pmes</span> <span class="id" title="var">m</span> (<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">m</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;= <span class="id" title="var">wfcex_pmes</span> (<span class="id" title="var">S</span> <span class="id" title="var">m</span>) <span class="id" title="var">l</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evar_open_evar_open_fresh_iter_base</span><br/>
&nbsp;&nbsp;{<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">avoid</span> <span class="id" title="var">m</span> <span class="id" title="var">n</span> <span class="id" title="var">phi</span> :<br/>
&nbsp;&nbsp;(<span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) <span class="id" title="var">m</span> <span class="id" title="var">phi</span>)^{<span class="id" title="tactic">evar</span>:<span class="id" title="var">n</span>↦(<span class="id" title="var">evar_fresh_nth</span> <span class="id" title="var">avoid</span> <span class="id" title="var">m</span>)}<br/>
&nbsp;&nbsp;= <span class="id" title="var">evar_open_fresh_iter_base</span> <span class="id" title="var">avoid</span> <span class="id" title="var">n</span> (<span class="id" title="var">S</span> <span class="id" title="var">m</span>) <span class="id" title="var">phi</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nested_const_fa'</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">Γ</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span> <span class="id" title="var">avoid</span> (<span class="id" title="var">m</span> : <span class="id" title="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" title="var">free_evars</span> (<span class="id" title="var">a</span> ---&gt; (<span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>)) ⊆ <span class="id" title="var">avoid</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> <span class="id" title="var">a</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_xy</span> <span class="id" title="var">m</span> 0 ((<span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> <span class="id" title="var">patt_bott</span> <span class="id" title="var">l</span>)) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢<span class="id" title="var">i</span> <span class="id" title="var">evar_open_fresh_iter</span> <span class="id" title="var">avoid</span> <span class="id" title="var">m</span> (<span class="id" title="var">a</span> ---&gt; (<span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>))<br/>
&nbsp;&nbsp;<span class="id" title="keyword">using</span> <span class="id" title="var">AnyReasoning</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nested_const_fa</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">Γ</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> <span class="id" title="var">a</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> ((<span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> <span class="id" title="var">patt_bott</span> <span class="id" title="var">l</span>)) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢<span class="id" title="var">i</span> (<span class="id" title="var">a</span> ---&gt; (<span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> <span class="id" title="var">a</span> <span class="id" title="var">l</span>))<br/>
&nbsp;&nbsp;<span class="id" title="keyword">using</span> <span class="id" title="var">AnyReasoning</span>.<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">wfcmu_pmes</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">idx</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">bool</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">pmes</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] ⇒ <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">pme_pattern</span> <span class="id" title="var">p</span>)::<span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;⇒ <span class="id" title="var">well_formed_closed_mu_aux</span> <span class="id" title="var">p</span> <span class="id" title="var">idx</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">wfcmu_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">pme_variable</span>)::<span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;⇒ <span class="id" title="var">wfcmu_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">wfp_pmes</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}<br/>
&nbsp;&nbsp;(<span class="id" title="var">pmes</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProofModeEntry</span>)<br/>
&nbsp;&nbsp;: <span class="id" title="var">bool</span><br/>
&nbsp;&nbsp;:=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">pmes</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] ⇒ <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">pme_pattern</span> <span class="id" title="var">p</span>)::<span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;⇒ <span class="id" title="var">well_formed_positive</span> <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">wfp_pmes</span> <span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">pme_variable</span>)::<span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;⇒ <span class="id" title="var">wfp_pmes</span> <span class="id" title="var">pmes'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfc_mu_aux_foldr_connect</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">g</span> <span class="id" title="var">pmes</span> <span class="id" title="var">k</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_mu_aux</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">g</span> <span class="id" title="var">pmes</span>) <span class="id" title="var">k</span> <br/>
&nbsp;&nbsp;= <span class="id" title="var">well_formed_closed_mu_aux</span> <span class="id" title="var">g</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">wfcmu_pmes</span> <span class="id" title="var">k</span> <span class="id" title="var">pmes</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfp_foldr_connect</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">g</span> <span class="id" title="var">pmes</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_positive</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">g</span> <span class="id" title="var">pmes</span>) <br/>
&nbsp;&nbsp;= <span class="id" title="var">well_formed_positive</span> <span class="id" title="var">g</span><br/>
&nbsp;&nbsp;&amp;&amp; <span class="id" title="var">wfp_pmes</span> <span class="id" title="var">pmes</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">evar_open_pmes_app</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">idx</span> <span class="id" title="var">x</span> <span class="id" title="var">l₁</span> <span class="id" title="var">l₂</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">x</span> (<span class="id" title="var">l₁</span> ++ <span class="id" title="var">l₂</span>)<br/>
&nbsp;&nbsp;= (<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">x</span> <span class="id" title="var">l₁</span>)<br/>
&nbsp;&nbsp;++ (<span class="id" title="var">evar_open_pmes</span> (<span class="id" title="var">idx</span> + <span class="id" title="var">foralls_count</span> <span class="id" title="var">l₁</span>) <span class="id" title="var">x</span> <span class="id" title="var">l₂</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfp_pmes_app</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">wfp_pmes</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>) = <span class="id" title="var">wfp_pmes</span> <span class="id" title="var">l1</span> &amp;&amp; <span class="id" title="var">wfp_pmes</span> <span class="id" title="var">l2</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfp_pmes_evar_open</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">l</span> <span class="id" title="var">idx</span> <span class="id" title="var">x</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">wfp_pmes</span> (<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>) = <span class="id" title="var">wfp_pmes</span> <span class="id" title="var">l</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfcmu_pmes_app</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">idx</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">wfcmu_pmes</span> <span class="id" title="var">idx</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>) = <span class="id" title="var">wfcmu_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">l1</span> &amp;&amp; <span class="id" title="var">wfcmu_pmes</span> <span class="id" title="var">idx</span> <span class="id" title="var">l2</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">foralls_count_app</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">foralls_count</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>) = <span class="id" title="var">foralls_count</span> <span class="id" title="var">l1</span> + <span class="id" title="var">foralls_count</span> <span class="id" title="var">l2</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">foralls_count_cons_pattern</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">l</span> <span class="id" title="var">p</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">foralls_count</span> ((<span class="id" title="var">pme_pattern</span> <span class="id" title="var">p</span>)::<span class="id" title="var">l</span>) = (<span class="id" title="var">foralls_count</span> <span class="id" title="var">l</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">foralls_count_cons_variable</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">l</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">foralls_count</span> ((<span class="id" title="var">pme_variable</span>)::<span class="id" title="var">l</span>) = <span class="id" title="var">S</span> (<span class="id" title="var">foralls_count</span> <span class="id" title="var">l</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfcex_pmes_app</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">k</span> <span class="id" title="var">l1</span> <span class="id" title="var">l2</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">wfcex_pmes</span> <span class="id" title="var">k</span> (<span class="id" title="var">l1</span> ++ <span class="id" title="var">l2</span>)<br/>
&nbsp;&nbsp;= <span class="id" title="var">wfcex_pmes</span> <span class="id" title="var">k</span> <span class="id" title="var">l1</span> &amp;&amp; <span class="id" title="var">wfcex_pmes</span> (<span class="id" title="var">k</span> + <span class="id" title="var">foralls_count</span> <span class="id" title="var">l1</span>) <span class="id" title="var">l2</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfc_mu_aux_body_iff'</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">phi</span> : <span class="id" title="var">Pattern</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">X</span> : <span class="id" title="var">svar</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_mu_aux</span> <span class="id" title="var">phi</span>^{<span class="id" title="var">svar</span>:<span class="id" title="var">n</span>↦<span class="id" title="var">X</span>} <span class="id" title="var">n</span>      <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">well_formed_closed_mu_aux</span> <span class="id" title="var">phi</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>)<br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfc_mu_aux_body_ex_iff'</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>}:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">phi</span> : <span class="id" title="var">Pattern</span>) (<span class="id" title="var">n</span> <span class="id" title="var">n'</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">x</span> : <span class="id" title="tactic">evar</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_mu_aux</span> <span class="id" title="var">phi</span>^{<span class="id" title="tactic">evar</span>:<span class="id" title="var">n'</span>↦<span class="id" title="var">x</span>} <span class="id" title="var">n</span>      <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="id" title="var">well_formed_closed_mu_aux</span> <span class="id" title="var">phi</span> <span class="id" title="var">n</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">wfcmu_pmes_evar_open_pmes</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">wfcmu_pmes</span> <span class="id" title="var">m</span> (<span class="id" title="var">evar_open_pmes</span> <span class="id" title="var">m'</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>)<br/>
&nbsp;&nbsp;= <span class="id" title="var">wfcmu_pmes</span> <span class="id" title="var">m</span> <span class="id" title="var">l</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">wf_simpl_rules</span> := (<br/>
&nbsp;&nbsp;@<span class="id" title="var">wfc_ex_aux_foldr_connect'</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">wfc_mu_aux_foldr_connect</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">wfp_foldr_connect</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">wfp_pmes_app</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">wfp_pmes_evar_open</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">wfcmu_pmes_app</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">foralls_count_app</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">foralls_count_evar_open_pmes</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">foralls_count_cons_pattern</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">foralls_count_cons_variable</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">wfcex_pmes_app</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">wfcex_pmes_evar_open_pmes_iff</span>,<br/>
&nbsp;&nbsp;@<span class="id" title="var">wfcmu_pmes_evar_open_pmes</span><br/>
).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">wf_simpl_goal</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">wf_simpl_rules</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">_wf_simpl_hyp</span> <span class="id" title="var">H</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> ?<span class="id" title="var">wf_simpl_rules</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Tactic Notation</span> "wf_simpl_hyp" <span class="id" title="var">ident</span>(<span class="id" title="var">H</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">_wf_simpl_hyp</span> <span class="id" title="var">H</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Ltac</span>2 <span class="id" title="keyword">Set</span> <span class="id" title="var">simplify_wf_goal_hook</span> <span class="id" title="keyword">as</span> <span class="id" title="var">oldhook</span> := <span class="id" title="keyword">fun</span> () ⇒<br/>
&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">ltac1</span>:(<span class="id" title="var">wf_simpl_goal</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">oldhook</span> ()<br/>
.<br/>

<br/>
<span class="id" title="keyword">Ltac</span>2 <span class="id" title="keyword">Set</span> <span class="id" title="var">simplify_wf_hyp_part_hook</span> <span class="id" title="keyword">as</span> <span class="id" title="var">oldhook</span> := <span class="id" title="keyword">fun</span> (<span class="id" title="var">h</span> : <span class="id" title="var">ident</span>) ⇒<br/>
&nbsp;&nbsp;<span class="id" title="var">ltac1</span>:(<span class="id" title="var">h</span> |- <span class="id" title="var">wf_simpl_hyp</span> <span class="id" title="var">h</span>) (<span class="id" title="var">Ltac1.of_ident</span> <span class="id" title="var">h</span>);<br/>
&nbsp;&nbsp;<span class="id" title="var">oldhook</span> <span class="id" title="var">h</span><br/>
.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">top_holds_in_any_context</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">Γ</span> <span class="id" title="var">l</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> (<span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">patt_top</span> <span class="id" title="var">l</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢<span class="id" title="var">i</span> <span class="id" title="var">foldr</span> <span class="id" title="var">connect</span> <span class="id" title="var">patt_top</span> <span class="id" title="var">l</span> <span class="id" title="keyword">using</span> <span class="id" title="var">AnyReasoning</span><br/>
.<br/>

<br/>
<span class="comment">(*<br/>
Check&nbsp;evar_open_pmes.<br/>
Lemma&nbsp;evar_open_fresh_iter_base_foldr_connect<br/>
&nbsp;&nbsp;{Σ&nbsp;:&nbsp;Signature}&nbsp;(base&nbsp;idx&nbsp;:&nbsp;nat)&nbsp;(a&nbsp;:&nbsp;Pattern)&nbsp;l:<br/>
&nbsp;&nbsp;evar_open_fresh_iter_base&nbsp;evs&nbsp;base&nbsp;idx&nbsp;(foldr&nbsp;connect&nbsp;a&nbsp;l)<br/>
&nbsp;&nbsp;=&nbsp;foldr<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connect<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(evar_open_fresh_iter_base&nbsp;evs&nbsp;base&nbsp;idx&nbsp;a)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(evar_open_pmes&nbsp;).<br/>
*)</span><br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">nested_const_middle_fa</span> {<span class="id" title="var">Σ</span> : <span class="id" title="var">Signature</span>} <span class="id" title="var">Γ</span> <span class="id" title="var">a</span> <span class="id" title="var">l₁</span> <span class="id" title="var">l₂</span> :<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed_closed_ex_aux</span> <span class="id" title="var">a</span> (<span class="id" title="var">foralls_count</span> <span class="id" title="var">l₁</span>) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">well_formed</span> ((<span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> <span class="id" title="var">a</span> (<span class="id" title="var">l₁</span> ++ (<span class="id" title="var">pme_pattern</span> <span class="id" title="var">a</span>) :: <span class="id" title="var">l₂</span>))) = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⊢<span class="id" title="var">i</span> (<span class="id" title="var">fold_right</span> <span class="id" title="var">connect</span> (<span class="id" title="var">a</span>) (<span class="id" title="var">l₁</span> ++ (<span class="id" title="var">pme_pattern</span> <span class="id" title="var">a</span>) :: <span class="id" title="var">l₂</span>))<br/>
&nbsp;&nbsp;<span class="id" title="keyword">using</span> <span class="id" title="var">AnyReasoning</span>.<br/>

<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">ml_scope</span>.<br/>
</div>
<hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>